<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="./styles/styles.css">
    <title>DJ Pauly Key</title>
</head>
<body>
    <header>
        <h1>Dj Pauly Keys</h1>
    </header>
    <div class="introduction">
        <p class="description">

        </p>
        <button class="reveal">
            Begin!
        </button>
        <button class="fade">
            Keep Jokes Displayed
        </button>
    </div>
    <div class="fun">
        <div class="animatedFun center hide"></div>
        <div class="animatedFun topRight hide"></div>
        <div class="animatedFun bottomRight hide"></div>
        <div class="animatedFun bottomLeft hide"></div>
        <div class="animatedFun topRight hide"></div>

        <div class="keyboard">
            <div class="numbers">
                <div data-key="49" class="key">
                    <kbd>1</kbd>
                </div>
                <div data-key="50" class="key">
                    <kbd>2</kbd>
                </div>
                <div data-key="51" class="key">
                    <kbd>3</kbd>
                </div>
                <div data-key="52" class="key">
                    <kbd>4</kbd>
                </div>
                <div data-key="53" class="key">
                    <kbd>5</kbd>
                </div>
                <div data-key="54" class="key">
                    <kbd>6</kbd>
                </div>
                <div data-key="55" class="key">
                    <kbd>7</kbd>
                </div>
                <div data-key="56" class="key">
                    <kbd>8</kbd>
                </div>
                <div data-key="57" class="key">
                    <kbd>9</kbd>
                </div>
                <div data-key="48" class="key">
                    <kbd>0</kbd>
                </div>
            </div>
            <div class="firstRow">
                <div data-key="81" class="key">
                    <kbd>Q</kbd>
                </div>
                <div data-key="87" class="key">
                    <kbd>W</kbd>
                </div>
                <div data-key="69" class="key">
                    <kbd>E</kbd>
                </div>
                <div data-key="82" class="key">
                    <kbd>R</kbd>
                </div>
                <div data-key="84" class="key">
                    <kbd>T</kbd>
                </div>
                <div data-key="85" class="key">
                    <kbd>Y</kbd>
                </div>
                <div data-key="89" class="key">
                    <kbd>U</kbd>
                </div>
                <div data-key="73" class="key">
                    <kbd>I</kbd>
                </div>
                <div data-key="79" class="key">
                    <kbd>O</kbd>
                </div>
                <div data-key="80" class="key">
                    <kbd>P</kbd>
                </div>
            </div>
            <div class="secondRow">
                <div data-key="65" class="key">
                    <kbd>A</kbd>
                </div>
                <div data-key="83" class="key">
                    <kbd>S</kbd>
                </div>
                <div data-key="68" class="key">
                    <kbd>D</kbd>
                </div>
                <div data-key="70" class="key">
                    <kbd>F</kbd>
                </div>
                <div data-key="71" class="key">
                    <kbd>G</kbd>
                </div>
                <div data-key="72" class="key">
                    <kbd>H</kbd>
                </div>
                <div data-key="74" class="key">
                    <kbd>J</kbd>
                </div>
                <div data-key="75" class="key">
                    <kbd>K</kbd>
                </div>
                <div data-key="76" class="key">
                    <kbd>L</kbd>
                </div>
                <div data-key="13" class="key">
                    <kbd>Enter</kbd>
                </div>
            </div>
            <div class="thirdRow">
                <div data-key="90" class="key">
                    <kbd>Z</kbd>
                </div>
                <div data-key="88" class="key">
                    <kbd>X</kbd>
                </div>
                <div data-key="67" class="key">
                    <kbd>C</kbd>
                </div>
                <div data-key="86" class="key">
                    <kbd>V</kbd>
                </div>
                <div data-key="66" class="key">
                    <kbd>B</kbd>
                </div>
                <div data-key="78" class="key">
                    <kbd>N</kbd>
                </div>
                <div data-key="77" class="key">
                    <kbd>M</kbd>
                </div>
            </div>
        </div>
    </div>

    <audio data-key="49" src=""></audio>
    <audio data-key="50" src=""></audio>
    <audio data-key="51" src=""></audio>
    <audio data-key="52" src=""></audio>
    <audio data-key="53" src=""></audio>
    <audio data-key="54" src=""></audio>
    <audio data-key="55" src=""></audio>
    <audio data-key="56" src=""></audio>
    <audio data-key="57" src=""></audio>
    <audio data-key="48" src=""></audio>

    <audio data-key="81" src=""></audio>
    <audio data-key="87" src=""></audio>
    <audio data-key="69" src=""></audio>
    <audio data-key="82" src=""></audio>
    <audio data-key="84" src=""></audio>
    <audio data-key="85" src=""></audio>
    <audio data-key="89" src=""></audio>
    <audio data-key="73" src=""></audio>
    <audio data-key="79" src=""></audio>
    <audio data-key="80" src=""></audio>

    <audio data-key="65" src=""></audio>
    <audio data-key="83" src=""></audio>
    <audio data-key="68" src=""></audio>
    <audio data-key="70" src=""></audio>
    <audio data-key="71" src=""></audio>
    <audio data-key="72" src=""></audio>
    <audio data-key="74" src=""></audio>
    <audio data-key="75" src=""></audio>
    <audio data-key="76" src=""></audio>
    <audio data-key="13" src=""></audio>

    <audio data-key="90" src=""></audio>
    <audio data-key="88" src=""></audio>
    <audio data-key="67" src=""></audio>
    <audio data-key="86" src=""></audio>
    <audio data-key="66" src=""></audio>
    <audio data-key="78" src=""></audio>
    <audio data-key="77" src=""></audio>


<script>
    playSound = (event) => {
        //2. next we want to select the audio element with the data-key that matches the key we pressed on the keyboard
        const audio = document.querySelector(`audio[data-key="${event.keyCode}"]`);
        const key = document.querySelector(`.key[data-key="${event.keyCode}"]`);

        if (audio != null && key != null) {
            //3. this will play the sound of the audio button we've pressed, ensuring that it's rewinded to the sound's start each time and allowing for repeated presses
            // audio.currentTime = 0;
            // audio.play();
            console.log(audio);
            // key.classList.add('playing');
        }
    }

    const getDadJokeData = async (url) => {
            // Return a new promise.
            return new Promise((resolve, reject) => {
                // Do the usual XHR stuff
                const xhr = new XMLHttpRequest();
                xhr.open('GET', url);
                xhr.setRequestHeader('Accept', 'application/json');
                xhr.onload = () => {
                    // This is called even on 404 etc
                    // so check the status
                    if (xhr.status == 200) {
                        // Resolve the promise with the response text
                        resolve(JSON.parse(xhr.responseText));
                    }
                    else {
                        // Otherwise reject with the status text
                        // which will hopefully be a meaningful error
                        reject(Error(xhr.statusText));
                    }
                };

                // Handle network errors
                xhr.onerror = () => {
                    reject(Error("Network Error"));
                };

                // Make the request
                xhr.send();
            });
        }

    const jokeDivs = document.querySelectorAll('.animatedFun');
    const fadeButton = document.querySelector('.fade');

    let fadeCheck = false;

    const changeCheck = (event) => {
        if (fadeCheck === false) {
            fadeCheck = !fadeCheck;
            event.currentTarget.innerHTML = 'Fade Jokes';
        }
        else if (fadeCheck === true) {
            fadeCheck = !fadeCheck;
            event.currentTarget.innerHTML = 'Keep Jokes Displayed';
        }
    }

    const fadeJokeDisplay = (element, content) => {
        const length = element.length;
        const div = element[Math.floor(Math.random() * jokeDivs.length)];
        div.classList.remove('hide');
        div.innerHTML = content

        setTimeout(element => {
            div.classList.add('hide');
        }, 1000);
    }

    const stableJokeDisplay = (element, content) => {
        const length = element.length;
        const div = element[Math.floor(Math.random() * jokeDivs.length)];
        if (div.classList.contains('hide')) {
            div.classList.remove('hide');
            div.innerHTML = content;
        }
        else {
            div.classList.add('hide');
            setTimeout(() => {
                div.innerHTML = content;
                div.classList.remove('hide');
            }, 750); 
        }
    }

    const showDadJoke = async () => {
        try {
            let dadJoke = await getDadJokeData('https://icanhazdadjoke.com/');
            // jokeDivs[Math.floor(Math.random() * jokeDivs.length)].innerHTML = dadJoke.joke;
            if (fadeCheck === false) {
                fadeJokeDisplay(jokeDivs, dadJoke.joke);
            } 
            else if (fadeCheck === true) {
                stableJokeDisplay(jokeDivs, dadJoke.joke);
            }
        }
        catch (err) {
            console.log('Request failed.  Returned status of ' + err)
        }
    }

    window.addEventListener('keydown', playSound);
    window.addEventListener('keydown', showDadJoke);
    fadeButton.addEventListener('click', changeCheck);
</script>
</body>
</html>